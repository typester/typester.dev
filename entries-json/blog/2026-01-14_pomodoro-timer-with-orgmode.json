{"title":"Cute menu-bar pomodoro timer integrated with org-mode","date":"2026-01-14T20:11:00-08:00","tags":["macos","emacs"],"eid":"6e3866ea-b80c-43af-a02c-0f3f96b7b12a","image":"https://live.staticflickr.com/65535/55042445645_67996edb20_o.png","content":"<p>I continue to improve my working environment on the Mac. Today, I built a simple system that displays a timer in the menu bar synchronized with my time tracking in <a href=\"https://orgmode.org/\">org-mode</a>.</p>\n<section class=\"image\">\n  <div>\n    <a data-flickr-embed=\"true\" href=\"https://www.flickr.com/photos/typester/55042445645/in/datetaken/\" title=\"Cute menu-bar timer integrated with org-mode (Emacs)\"><img src=\"https://live.staticflickr.com/65535/55042445645_67996edb20_o.png\" width=\"546\" height=\"82\" alt=\"Cute menu-bar timer integrated with org-mode (Emacs)\"/></a><script async src=\"//embedr.flickr.com/assets/client-code.js\" charset=\"utf-8\"></script>\n  </div>\n</section>\n\n<p>I am an avid user of org-mode (I'm writing this blog post in org as well<a class=\"footref\" href=\"#fn1\" id=\"r1\">[1]</a>), so naturally, I manage my tasks with org-mode.\nOn the other hand, to maintain focus for long periods, I also use a Pomodoro timer. I felt that there were many lovely Pomodoro apps available for Mac, so I was looking forward to trying them out.</p>\n<p>However, once I started using them, the double operation of starting the timer and then \"clocking in\" to the actual task in Emacs became a pain. I started to think that managing the Pomodoro timer in an external app wasn't realistic.</p>\n<p>That said, I really fell in love with the cute design of the menu bar timer in an app called <a href=\"https://www.flow.app/\">Flow</a> that I tried at the time, and I began wondering if I could somehow link them together.</p>\n<p>When I consulted Gemini, it suggested that I could either write a native app myself or use <a href=\"https://github.com/swiftbar/SwiftBar\">SwiftBar</a>. The fact that \"writing a native app yourself\" and \"using an app like SwiftBar\" are presented as equal options really feels like the era of \"vibe coding.\"</p>\n<p>SwiftBar is an open-source macOS utility that allows you to create custom menu bar items using scripts (Bash, Python, Ruby, Swift, etc.). It essentially takes the STDOUT of a script and renders it in the menu bar, making it incredibly easy to display information or create simple interactive tools without full app development.</p>\n<p>SwiftBar seemed easier, but the question was whether I could reproduce that specific design. So, I decided to try SwiftBar first, and if I couldn't replicate the design, I would build a native app.</p>\n<h3>Displaying images with SwiftBar</h3>\n<p>SwiftBar plugins work by outputting what you want to display to STDOUT, so they are primarily for text. However, it seems possible to display images by outputting them as base64 strings.</p>\n<p>I initially tried to do this with Python, but I couldn't get the image to look crisp. When I consulted Gemini again, it said, \"You should write it in Swift,\" and provided me with some Swift code. It looked like the Swift version could get very close to the desired look with some tweaking, so I based my final version on that. Here is the result:</p>\n<pre><code class=\"swift\"><span class=\"swift-modeXpreprocessor-keyword\">#</span><span class=\"swift-modeXoperator\">!/</span>usr<span class=\"swift-modeXregexp\">/bin/</span>env <span class=\"swift-modeXbuild-config-keyword\">swift</span>\n\n<span class=\"swift-modeXkeyword\">import</span> <span class=\"swift-modeXtype\">Foundation</span>\n<span class=\"swift-modeXkeyword\">import</span> <span class=\"swift-modeXtype\">Cocoa</span>\n<span class=\"swift-modeXkeyword\">import</span> <span class=\"swift-modeXtype\">CoreGraphics</span>\n\n<span class=\"swift-modeXcomment-delimiter\">//</span><span class=\"swift-modeXcomment\"> --- Configuration ---</span>\n<span class=\"swift-modeXkeyword\">let</span> workTimerFile <span class=\"swift-modeXoperator\">=</span> <span class=\"swift-modeXstring\">\"/tmp/my_pomodoro_timer\"</span>\n<span class=\"swift-modeXkeyword\">let</span> breakTimerFile <span class=\"swift-modeXoperator\">=</span> <span class=\"swift-modeXstring\">\"/tmp/my_break_timer\"</span>\n\n<span class=\"swift-modeXkeyword\">let</span> workDuration<span class=\"swift-modeXdelimiter\">:</span> <span class=\"swift-modeXbuiltin-type\">Double</span> <span class=\"swift-modeXoperator\">=</span> <span class=\"swift-modeXnumber\">25.0</span>\n<span class=\"swift-modeXkeyword\">let</span> breakDuration<span class=\"swift-modeXdelimiter\">:</span> <span class=\"swift-modeXbuiltin-type\">Double</span> <span class=\"swift-modeXoperator\">=</span> <span class=\"swift-modeXnumber\">5.0</span>\n\n<span class=\"swift-modeXkeyword\">let</span> emacsClient <span class=\"swift-modeXoperator\">=</span> <span class=\"swift-modeXstring\">\"/opt/homebrew/bin/emacsclient\"</span>\n<span class=\"swift-modeXkeyword\">let</span> soundFile <span class=\"swift-modeXoperator\">=</span> <span class=\"swift-modeXstring\">\"/System/Library/Sounds/Glass.aiff\"</span>\n\n<span class=\"swift-modeXcomment-delimiter\">//</span><span class=\"swift-modeXcomment\"> --- Visual Settings ---</span>\n<span class=\"swift-modeXkeyword\">let</span> logicalWidth<span class=\"swift-modeXdelimiter\">:</span> <span class=\"swift-modeXbuiltin-type\">CGFloat</span> <span class=\"swift-modeXoperator\">=</span> <span class=\"swift-modeXnumber\">44</span>\n<span class=\"swift-modeXkeyword\">let</span> logicalHeight<span class=\"swift-modeXdelimiter\">:</span> <span class=\"swift-modeXbuiltin-type\">CGFloat</span> <span class=\"swift-modeXoperator\">=</span> <span class=\"swift-modeXnumber\">16</span>\n<span class=\"swift-modeXkeyword\">let</span> scale<span class=\"swift-modeXdelimiter\">:</span> <span class=\"swift-modeXbuiltin-type\">CGFloat</span> <span class=\"swift-modeXoperator\">=</span> <span class=\"swift-modeXnumber\">1.0</span>\n\n<span class=\"swift-modeXkeyword\">let</span> colorWork <span class=\"swift-modeXoperator\">=</span> <span class=\"swift-modeXtype\">NSColor</span><span class=\"swift-modeXoperator\">.</span><span class=\"swift-modeXproperty-access\">white</span>\n<span class=\"swift-modeXkeyword\">let</span> colorBreak <span class=\"swift-modeXoperator\">=</span> <span class=\"swift-modeXtype\">NSColor</span><span class=\"swift-modeXbracket\">(</span>srgbRed<span class=\"swift-modeXdelimiter\">:</span> <span class=\"swift-modeXnumber\">0.4</span><span class=\"swift-modeXdelimiter\">,</span> green<span class=\"swift-modeXdelimiter\">:</span> <span class=\"swift-modeXnumber\">0.85</span><span class=\"swift-modeXdelimiter\">,</span> blue<span class=\"swift-modeXdelimiter\">:</span> <span class=\"swift-modeXnumber\">0.65</span><span class=\"swift-modeXdelimiter\">,</span> alpha<span class=\"swift-modeXdelimiter\">:</span> <span class=\"swift-modeXnumber\">1.0</span><span class=\"swift-modeXbracket\">)</span>\n\n<span class=\"swift-modeXcomment-delimiter\">//</span><span class=\"swift-modeXcomment\"> --- Helpers ---</span>\n<span class=\"swift-modeXkeyword\">func</span> <span class=\"swift-modeXfunction-name\">runShell</span><span class=\"swift-modeXbracket\">(</span>_ command<span class=\"swift-modeXdelimiter\">:</span> <span class=\"swift-modeXbuiltin-type\">String</span><span class=\"swift-modeXdelimiter\">,</span> wait<span class=\"swift-modeXdelimiter\">:</span> <span class=\"swift-modeXbuiltin-type\">Bool</span> <span class=\"swift-modeXoperator\">=</span> <span class=\"swift-modeXconstant-keyword\">true</span><span class=\"swift-modeXbracket\">)</span> <span class=\"swift-modeXbracket\">{</span>\n    <span class=\"swift-modeXkeyword\">let</span> task <span class=\"swift-modeXoperator\">=</span> <span class=\"swift-modeXbuiltin-type\">Process</span><span class=\"swift-modeXbracket\">()</span>\n    <span class=\"swift-modeXcomment-delimiter\">//</span><span class=\"swift-modeXcomment\"> Discard output</span>\n    task<span class=\"swift-modeXoperator\">.</span><span class=\"swift-modeXbuiltin-property\">standardOutput</span> <span class=\"swift-modeXoperator\">=</span> <span class=\"swift-modeXbuiltin-type\">FileHandle</span><span class=\"swift-modeXoperator\">.</span><span class=\"swift-modeXbuiltin-property\">nullDevice</span>\n    task<span class=\"swift-modeXoperator\">.</span><span class=\"swift-modeXbuiltin-property\">standardError</span> <span class=\"swift-modeXoperator\">=</span> <span class=\"swift-modeXbuiltin-type\">FileHandle</span><span class=\"swift-modeXoperator\">.</span><span class=\"swift-modeXbuiltin-property\">nullDevice</span>\n    task<span class=\"swift-modeXoperator\">.</span><span class=\"swift-modeXbuiltin-property\">launchPath</span> <span class=\"swift-modeXoperator\">=</span> <span class=\"swift-modeXstring\">\"/bin/bash\"</span>\n    task<span class=\"swift-modeXoperator\">.</span><span class=\"swift-modeXbuiltin-property\">arguments</span> <span class=\"swift-modeXoperator\">=</span> <span class=\"swift-modeXbracket\">[</span><span class=\"swift-modeXstring\">\"-c\"</span><span class=\"swift-modeXdelimiter\">,</span> command<span class=\"swift-modeXbracket\">]</span>\n    task<span class=\"swift-modeXoperator\">.</span><span class=\"swift-modeXbuiltin-method\">launch</span><span class=\"swift-modeXbracket\">()</span>\n\n    <span class=\"swift-modeXkeyword\">if</span> <span class=\"swift-modeXfunction-call\">wait</span> <span class=\"swift-modeXbracket\">{</span>\n        task<span class=\"swift-modeXoperator\">.</span><span class=\"swift-modeXbuiltin-method\">waitUntilExit</span><span class=\"swift-modeXbracket\">()</span>\n    <span class=\"swift-modeXbracket\">}</span>\n<span class=\"swift-modeXbracket\">}</span>\n\n<span class=\"swift-modeXkeyword\">func</span> <span class=\"swift-modeXfunction-name\">readFile</span><span class=\"swift-modeXbracket\">(</span>_ path<span class=\"swift-modeXdelimiter\">:</span> <span class=\"swift-modeXbuiltin-type\">String</span><span class=\"swift-modeXbracket\">)</span> <span class=\"swift-modeXoperator\">-&gt;</span> <span class=\"swift-modeXbuiltin-type\">Double</span><span class=\"swift-modeXoperator\">?</span> <span class=\"swift-modeXbracket\">{</span>\n    <span class=\"swift-modeXkeyword\">guard</span> <span class=\"swift-modeXkeyword\">let</span> content <span class=\"swift-modeXoperator\">=</span> <span class=\"swift-modeXkeyword\">try</span><span class=\"swift-modeXoperator\">?</span> <span class=\"swift-modeXbuiltin-type\">String</span><span class=\"swift-modeXbracket\">(</span>contentsOfFile<span class=\"swift-modeXdelimiter\">:</span> path<span class=\"swift-modeXbracket\">)</span><span class=\"swift-modeXdelimiter\">,</span>\n          <span class=\"swift-modeXkeyword\">let</span> timestamp <span class=\"swift-modeXoperator\">=</span> <span class=\"swift-modeXbuiltin-type\">Double</span><span class=\"swift-modeXbracket\">(</span>content<span class=\"swift-modeXoperator\">.</span><span class=\"swift-modeXbuiltin-method\">trimmingCharacters</span><span class=\"swift-modeXbracket\">(</span><span class=\"swift-modeXkeyword\">in</span><span class=\"swift-modeXdelimiter\">:</span> <span class=\"swift-modeXoperator\">.</span><span class=\"swift-modeXbuiltin-property\">whitespacesAndNewlines</span><span class=\"swift-modeXbracket\">))</span> <span class=\"swift-modeXkeyword\">else</span> <span class=\"swift-modeXbracket\">{</span>\n        <span class=\"swift-modeXkeyword\">return</span> <span class=\"swift-modeXconstant-keyword\">nil</span>\n    <span class=\"swift-modeXbracket\">}</span>\n    <span class=\"swift-modeXkeyword\">return</span> timestamp\n<span class=\"swift-modeXbracket\">}</span>\n\n<span class=\"swift-modeXkeyword\">func</span> <span class=\"swift-modeXfunction-name\">writeFile</span><span class=\"swift-modeXbracket\">(</span>_ path<span class=\"swift-modeXdelimiter\">:</span> <span class=\"swift-modeXbuiltin-type\">String</span><span class=\"swift-modeXdelimiter\">,</span> timestamp<span class=\"swift-modeXdelimiter\">:</span> <span class=\"swift-modeXbuiltin-type\">Double</span><span class=\"swift-modeXbracket\">)</span> <span class=\"swift-modeXbracket\">{</span>\n    <span class=\"swift-modeXkeyword\">try</span><span class=\"swift-modeXoperator\">?</span> <span class=\"swift-modeXstring\">\"</span><span class=\"swift-modeXstring\"><span class=\"swift-modeXmisc-punctuation\">\\(</span></span>timestamp<span class=\"swift-modeXstring\"><span class=\"swift-modeXmisc-punctuation\">)</span></span><span class=\"swift-modeXstring\">\"</span><span class=\"swift-modeXoperator\">.</span><span class=\"swift-modeXbuiltin-method\">write</span><span class=\"swift-modeXbracket\">(</span>toFile<span class=\"swift-modeXdelimiter\">:</span> path<span class=\"swift-modeXdelimiter\">,</span> atomically<span class=\"swift-modeXdelimiter\">:</span> <span class=\"swift-modeXconstant-keyword\">true</span><span class=\"swift-modeXdelimiter\">,</span> encoding<span class=\"swift-modeXdelimiter\">:</span> <span class=\"swift-modeXoperator\">.</span><span class=\"swift-modeXbuiltin-property\">utf8</span><span class=\"swift-modeXbracket\">)</span>\n<span class=\"swift-modeXbracket\">}</span>\n\n<span class=\"swift-modeXkeyword\">func</span> <span class=\"swift-modeXfunction-name\">deleteFile</span><span class=\"swift-modeXbracket\">(</span>_ path<span class=\"swift-modeXdelimiter\">:</span> <span class=\"swift-modeXbuiltin-type\">String</span><span class=\"swift-modeXbracket\">)</span> <span class=\"swift-modeXbracket\">{</span>\n    <span class=\"swift-modeXkeyword\">try</span><span class=\"swift-modeXoperator\">?</span> <span class=\"swift-modeXbuiltin-type\">FileManager</span><span class=\"swift-modeXoperator\">.</span><span class=\"swift-modeXkeyword\">default</span><span class=\"swift-modeXoperator\">.</span><span class=\"swift-modeXbuiltin-method\">removeItem</span><span class=\"swift-modeXbracket\">(</span>atPath<span class=\"swift-modeXdelimiter\">:</span> path<span class=\"swift-modeXbracket\">)</span>\n<span class=\"swift-modeXbracket\">}</span>\n\n<span class=\"swift-modeXcomment-delimiter\">//</span><span class=\"swift-modeXcomment\"> --- CLI Command Handling ---</span>\n<span class=\"swift-modeXkeyword\">let</span> args <span class=\"swift-modeXoperator\">=</span> <span class=\"swift-modeXbuiltin-type\">CommandLine</span><span class=\"swift-modeXoperator\">.</span><span class=\"swift-modeXbuiltin-property\">arguments</span>\n<span class=\"swift-modeXkeyword\">if</span> args<span class=\"swift-modeXoperator\">.</span><span class=\"swift-modeXbuiltin-property\">count</span> <span class=\"swift-modeXoperator\">&gt;</span> <span class=\"swift-modeXnumber\">1</span> <span class=\"swift-modeXbracket\">{</span>\n    <span class=\"swift-modeXkeyword\">let</span> command <span class=\"swift-modeXoperator\">=</span> args<span class=\"swift-modeXbracket\">[</span><span class=\"swift-modeXnumber\">1</span><span class=\"swift-modeXbracket\">]</span>\n\n    <span class=\"swift-modeXkeyword\">if</span> command <span class=\"swift-modeXoperator\">==</span> <span class=\"swift-modeXstring\">\"stop_work\"</span> <span class=\"swift-modeXbracket\">{</span>\n        <span class=\"swift-modeXfunction-call\">runShell</span><span class=\"swift-modeXbracket\">(</span><span class=\"swift-modeXstring\">\"</span><span class=\"swift-modeXstring\"><span class=\"swift-modeXmisc-punctuation\">\\(</span></span>emacsClient<span class=\"swift-modeXstring\"><span class=\"swift-modeXmisc-punctuation\">)</span></span><span class=\"swift-modeXstring\"> -n --eval '(org-clock-out)'\"</span><span class=\"swift-modeXbracket\">)</span>\n        <span class=\"swift-modeXcomment-delimiter\">//</span><span class=\"swift-modeXcomment\"> Note: Emacs removes the file, but we can do it here too just in case</span>\n        <span class=\"swift-modeXfunction-call\">deleteFile</span><span class=\"swift-modeXbracket\">(</span>workTimerFile<span class=\"swift-modeXbracket\">)</span>\n    <span class=\"swift-modeXbracket\">}</span> <span class=\"swift-modeXkeyword\">else</span> <span class=\"swift-modeXkeyword\">if</span> command <span class=\"swift-modeXoperator\">==</span> <span class=\"swift-modeXstring\">\"stop_break\"</span> <span class=\"swift-modeXbracket\">{</span>\n        <span class=\"swift-modeXfunction-call\">deleteFile</span><span class=\"swift-modeXbracket\">(</span>breakTimerFile<span class=\"swift-modeXbracket\">)</span>\n    <span class=\"swift-modeXbracket\">}</span>\n    <span class=\"swift-modeXfunction-call\">exit</span><span class=\"swift-modeXbracket\">(</span><span class=\"swift-modeXnumber\">0</span><span class=\"swift-modeXbracket\">)</span>\n<span class=\"swift-modeXbracket\">}</span>\n\n<span class=\"swift-modeXcomment-delimiter\">//</span><span class=\"swift-modeXcomment\"> --- Timer Logic ---</span>\n<span class=\"swift-modeXkeyword\">enum</span> <span class=\"swift-modeXtype\">TimerState</span> <span class=\"swift-modeXbracket\">{</span>\n    <span class=\"swift-modeXkeyword\">case</span> <span class=\"swift-modeXfunction-call\">work</span><span class=\"swift-modeXbracket\">(</span><span class=\"swift-modeXbuiltin-type\">String</span><span class=\"swift-modeXbracket\">)</span>\n    <span class=\"swift-modeXkeyword\">case</span> <span class=\"swift-modeXfunction-call\">breakTime</span><span class=\"swift-modeXbracket\">(</span><span class=\"swift-modeXbuiltin-type\">String</span><span class=\"swift-modeXbracket\">)</span>\n    <span class=\"swift-modeXkeyword\">case</span> idle\n<span class=\"swift-modeXbracket\">}</span>\n\n<span class=\"swift-modeXkeyword\">func</span> <span class=\"swift-modeXfunction-name\">getCurrentState</span><span class=\"swift-modeXbracket\">()</span> <span class=\"swift-modeXoperator\">-&gt;</span> <span class=\"swift-modeXtype\">TimerState</span> <span class=\"swift-modeXbracket\">{</span>\n    <span class=\"swift-modeXkeyword\">let</span> now <span class=\"swift-modeXoperator\">=</span> <span class=\"swift-modeXbuiltin-type\">Date</span><span class=\"swift-modeXbracket\">()</span><span class=\"swift-modeXoperator\">.</span><span class=\"swift-modeXbuiltin-property\">timeIntervalSince1970</span>\n\n    <span class=\"swift-modeXcomment-delimiter\">//</span><span class=\"swift-modeXcomment\"> 1. Work Timer (Managed by Emacs)</span>\n    <span class=\"swift-modeXkeyword\">if</span> <span class=\"swift-modeXkeyword\">let</span> workEnd <span class=\"swift-modeXoperator\">=</span> <span class=\"swift-modeXfunction-call\">readFile</span><span class=\"swift-modeXbracket\">(</span>workTimerFile<span class=\"swift-modeXbracket\">)</span> <span class=\"swift-modeXbracket\">{</span>\n\n        <span class=\"swift-modeXcomment-delimiter\">//</span><span class=\"swift-modeXcomment\"> Cancel break if work starts</span>\n        <span class=\"swift-modeXkeyword\">if</span> <span class=\"swift-modeXbuiltin-type\">FileManager</span><span class=\"swift-modeXoperator\">.</span><span class=\"swift-modeXkeyword\">default</span><span class=\"swift-modeXoperator\">.</span><span class=\"swift-modeXbuiltin-method\">fileExists</span><span class=\"swift-modeXbracket\">(</span>atPath<span class=\"swift-modeXdelimiter\">:</span> breakTimerFile<span class=\"swift-modeXbracket\">)</span> <span class=\"swift-modeXbracket\">{</span>\n            <span class=\"swift-modeXfunction-call\">deleteFile</span><span class=\"swift-modeXbracket\">(</span>breakTimerFile<span class=\"swift-modeXbracket\">)</span>\n        <span class=\"swift-modeXbracket\">}</span>\n\n        <span class=\"swift-modeXkeyword\">let</span> remaining <span class=\"swift-modeXoperator\">=</span> workEnd <span class=\"swift-modeXoperator\">-</span> now\n        <span class=\"swift-modeXkeyword\">if</span> remaining <span class=\"swift-modeXoperator\">&gt;</span> <span class=\"swift-modeXnumber\">0</span> <span class=\"swift-modeXbracket\">{</span>\n            <span class=\"swift-modeXkeyword\">let</span> m <span class=\"swift-modeXoperator\">=</span> <span class=\"swift-modeXbuiltin-type\">Int</span><span class=\"swift-modeXbracket\">(</span>remaining<span class=\"swift-modeXbracket\">)</span> <span class=\"swift-modeXoperator\">/</span> <span class=\"swift-modeXnumber\">60</span>\n            <span class=\"swift-modeXkeyword\">let</span> s <span class=\"swift-modeXoperator\">=</span> <span class=\"swift-modeXbuiltin-type\">Int</span><span class=\"swift-modeXbracket\">(</span>remaining<span class=\"swift-modeXbracket\">)</span> <span class=\"swift-modeXoperator\">%</span> <span class=\"swift-modeXnumber\">60</span>\n            <span class=\"swift-modeXkeyword\">return</span> <span class=\"swift-modeXoperator\">.</span><span class=\"swift-modeXfunction-call\">work</span><span class=\"swift-modeXbracket\">(</span><span class=\"swift-modeXbuiltin-type\">String</span><span class=\"swift-modeXbracket\">(</span>format<span class=\"swift-modeXdelimiter\">:</span> <span class=\"swift-modeXstring\">\"%02d:%02d\"</span><span class=\"swift-modeXdelimiter\">,</span> m<span class=\"swift-modeXdelimiter\">,</span> s<span class=\"swift-modeXbracket\">))</span>\n        <span class=\"swift-modeXbracket\">}</span> <span class=\"swift-modeXkeyword\">else</span> <span class=\"swift-modeXbracket\">{</span>\n            <span class=\"swift-modeXcomment-delimiter\">//</span><span class=\"swift-modeXcomment\"> --- Work finished ---</span>\n\n            <span class=\"swift-modeXcomment-delimiter\">//</span><span class=\"swift-modeXcomment\"> 1. CRITICAL: Delete file FIRST to prevent race conditions (loops)</span>\n            <span class=\"swift-modeXfunction-call\">deleteFile</span><span class=\"swift-modeXbracket\">(</span>workTimerFile<span class=\"swift-modeXbracket\">)</span>\n\n            <span class=\"swift-modeXcomment-delimiter\">//</span><span class=\"swift-modeXcomment\"> 2. Create Break Timer immediately</span>\n            <span class=\"swift-modeXkeyword\">let</span> breakEnd <span class=\"swift-modeXoperator\">=</span> now <span class=\"swift-modeXoperator\">+</span> <span class=\"swift-modeXbracket\">(</span>breakDuration <span class=\"swift-modeXoperator\">*</span> <span class=\"swift-modeXnumber\">60</span><span class=\"swift-modeXbracket\">)</span>\n            <span class=\"swift-modeXfunction-call\">writeFile</span><span class=\"swift-modeXbracket\">(</span>breakTimerFile<span class=\"swift-modeXdelimiter\">,</span> timestamp<span class=\"swift-modeXdelimiter\">:</span> breakEnd<span class=\"swift-modeXbracket\">)</span>\n\n            <span class=\"swift-modeXcomment-delimiter\">//</span><span class=\"swift-modeXcomment\"> 3. Run commands in background (async) so UI doesn't freeze</span>\n            <span class=\"swift-modeXcomment-delimiter\">//</span><span class=\"swift-modeXcomment\">    Using '&amp;' in shell to detach</span>\n            <span class=\"swift-modeXfunction-call\">runShell</span><span class=\"swift-modeXbracket\">(</span><span class=\"swift-modeXstring\">\"afplay </span><span class=\"swift-modeXstring\"><span class=\"swift-modeXmisc-punctuation\">\\(</span></span>soundFile<span class=\"swift-modeXstring\"><span class=\"swift-modeXmisc-punctuation\">)</span></span><span class=\"swift-modeXstring\"> &amp;\"</span><span class=\"swift-modeXdelimiter\">,</span> wait<span class=\"swift-modeXdelimiter\">:</span> <span class=\"swift-modeXconstant-keyword\">false</span><span class=\"swift-modeXbracket\">)</span>\n            <span class=\"swift-modeXfunction-call\">runShell</span><span class=\"swift-modeXbracket\">(</span><span class=\"swift-modeXstring\">\"</span><span class=\"swift-modeXstring\"><span class=\"swift-modeXmisc-punctuation\">\\(</span></span>emacsClient<span class=\"swift-modeXstring\"><span class=\"swift-modeXmisc-punctuation\">)</span></span><span class=\"swift-modeXstring\"> -n --eval '(org-clock-out)' &amp;\"</span><span class=\"swift-modeXdelimiter\">,</span> wait<span class=\"swift-modeXdelimiter\">:</span> <span class=\"swift-modeXconstant-keyword\">false</span><span class=\"swift-modeXbracket\">)</span>\n\n            <span class=\"swift-modeXkeyword\">return</span> <span class=\"swift-modeXoperator\">.</span><span class=\"swift-modeXfunction-call\">breakTime</span><span class=\"swift-modeXbracket\">(</span><span class=\"swift-modeXbuiltin-type\">String</span><span class=\"swift-modeXbracket\">(</span>format<span class=\"swift-modeXdelimiter\">:</span> <span class=\"swift-modeXstring\">\"%.0f:00\"</span><span class=\"swift-modeXdelimiter\">,</span> breakDuration<span class=\"swift-modeXbracket\">))</span>\n        <span class=\"swift-modeXbracket\">}</span>\n    <span class=\"swift-modeXbracket\">}</span>\n\n    <span class=\"swift-modeXcomment-delimiter\">//</span><span class=\"swift-modeXcomment\"> 2. Break Timer (Managed by Swift)</span>\n    <span class=\"swift-modeXkeyword\">if</span> <span class=\"swift-modeXkeyword\">let</span> breakEnd <span class=\"swift-modeXoperator\">=</span> <span class=\"swift-modeXfunction-call\">readFile</span><span class=\"swift-modeXbracket\">(</span>breakTimerFile<span class=\"swift-modeXbracket\">)</span> <span class=\"swift-modeXbracket\">{</span>\n        <span class=\"swift-modeXkeyword\">let</span> remaining <span class=\"swift-modeXoperator\">=</span> breakEnd <span class=\"swift-modeXoperator\">-</span> now\n        <span class=\"swift-modeXkeyword\">if</span> remaining <span class=\"swift-modeXoperator\">&gt;</span> <span class=\"swift-modeXnumber\">0</span> <span class=\"swift-modeXbracket\">{</span>\n            <span class=\"swift-modeXkeyword\">let</span> m <span class=\"swift-modeXoperator\">=</span> <span class=\"swift-modeXbuiltin-type\">Int</span><span class=\"swift-modeXbracket\">(</span>remaining<span class=\"swift-modeXbracket\">)</span> <span class=\"swift-modeXoperator\">/</span> <span class=\"swift-modeXnumber\">60</span>\n            <span class=\"swift-modeXkeyword\">let</span> s <span class=\"swift-modeXoperator\">=</span> <span class=\"swift-modeXbuiltin-type\">Int</span><span class=\"swift-modeXbracket\">(</span>remaining<span class=\"swift-modeXbracket\">)</span> <span class=\"swift-modeXoperator\">%</span> <span class=\"swift-modeXnumber\">60</span>\n            <span class=\"swift-modeXkeyword\">return</span> <span class=\"swift-modeXoperator\">.</span><span class=\"swift-modeXfunction-call\">breakTime</span><span class=\"swift-modeXbracket\">(</span><span class=\"swift-modeXbuiltin-type\">String</span><span class=\"swift-modeXbracket\">(</span>format<span class=\"swift-modeXdelimiter\">:</span> <span class=\"swift-modeXstring\">\"%02d:%02d\"</span><span class=\"swift-modeXdelimiter\">,</span> m<span class=\"swift-modeXdelimiter\">,</span> s<span class=\"swift-modeXbracket\">))</span>\n        <span class=\"swift-modeXbracket\">}</span> <span class=\"swift-modeXkeyword\">else</span> <span class=\"swift-modeXbracket\">{</span>\n            <span class=\"swift-modeXcomment-delimiter\">//</span><span class=\"swift-modeXcomment\"> --- Break finished ---</span>\n            <span class=\"swift-modeXfunction-call\">deleteFile</span><span class=\"swift-modeXbracket\">(</span>breakTimerFile<span class=\"swift-modeXbracket\">)</span>\n            <span class=\"swift-modeXfunction-call\">runShell</span><span class=\"swift-modeXbracket\">(</span><span class=\"swift-modeXstring\">\"afplay </span><span class=\"swift-modeXstring\"><span class=\"swift-modeXmisc-punctuation\">\\(</span></span>soundFile<span class=\"swift-modeXstring\"><span class=\"swift-modeXmisc-punctuation\">)</span></span><span class=\"swift-modeXstring\"> &amp;\"</span><span class=\"swift-modeXdelimiter\">,</span> wait<span class=\"swift-modeXdelimiter\">:</span> <span class=\"swift-modeXconstant-keyword\">false</span><span class=\"swift-modeXbracket\">)</span>\n            <span class=\"swift-modeXkeyword\">return</span> <span class=\"swift-modeXoperator\">.</span><span class=\"swift-modeXproperty-access\">idle</span>\n        <span class=\"swift-modeXbracket\">}</span>\n    <span class=\"swift-modeXbracket\">}</span>\n\n    <span class=\"swift-modeXkeyword\">return</span> <span class=\"swift-modeXoperator\">.</span><span class=\"swift-modeXproperty-access\">idle</span>\n<span class=\"swift-modeXbracket\">}</span>\n\n<span class=\"swift-modeXcomment-delimiter\">//</span><span class=\"swift-modeXcomment\"> --- Rendering ---</span>\n<span class=\"swift-modeXkeyword\">func</span> <span class=\"swift-modeXfunction-name\">createBase64Image</span><span class=\"swift-modeXbracket\">(</span>text<span class=\"swift-modeXdelimiter\">:</span> <span class=\"swift-modeXbuiltin-type\">String</span><span class=\"swift-modeXdelimiter\">,</span> color<span class=\"swift-modeXdelimiter\">:</span> <span class=\"swift-modeXtype\">NSColor</span><span class=\"swift-modeXbracket\">)</span> <span class=\"swift-modeXoperator\">-&gt;</span> <span class=\"swift-modeXbuiltin-type\">String</span> <span class=\"swift-modeXbracket\">{</span>\n    <span class=\"swift-modeXkeyword\">let</span> width <span class=\"swift-modeXoperator\">=</span> logicalWidth <span class=\"swift-modeXoperator\">*</span> scale\n    <span class=\"swift-modeXkeyword\">let</span> height <span class=\"swift-modeXoperator\">=</span> logicalHeight <span class=\"swift-modeXoperator\">*</span> scale\n    <span class=\"swift-modeXkeyword\">let</span> cornerRadius <span class=\"swift-modeXoperator\">=</span> <span class=\"swift-modeXnumber\">5.5</span> <span class=\"swift-modeXoperator\">*</span> scale\n    <span class=\"swift-modeXkeyword\">let</span> borderWidth <span class=\"swift-modeXoperator\">=</span> <span class=\"swift-modeXnumber\">0.8</span> <span class=\"swift-modeXoperator\">*</span> scale\n    <span class=\"swift-modeXkeyword\">let</span> fontSize <span class=\"swift-modeXoperator\">=</span> <span class=\"swift-modeXnumber\">10.5</span> <span class=\"swift-modeXoperator\">*</span> scale\n\n    <span class=\"swift-modeXkeyword\">let</span> size <span class=\"swift-modeXoperator\">=</span> <span class=\"swift-modeXbuiltin-type\">NSSize</span><span class=\"swift-modeXbracket\">(</span>width<span class=\"swift-modeXdelimiter\">:</span> width<span class=\"swift-modeXdelimiter\">,</span> height<span class=\"swift-modeXdelimiter\">:</span> height<span class=\"swift-modeXbracket\">)</span>\n    <span class=\"swift-modeXkeyword\">let</span> img <span class=\"swift-modeXoperator\">=</span> <span class=\"swift-modeXtype\">NSImage</span><span class=\"swift-modeXbracket\">(</span>size<span class=\"swift-modeXdelimiter\">:</span> size<span class=\"swift-modeXbracket\">)</span>\n\n    img<span class=\"swift-modeXoperator\">.</span><span class=\"swift-modeXfunction-call\">lockFocus</span><span class=\"swift-modeXbracket\">()</span>\n    <span class=\"swift-modeXkeyword\">guard</span> <span class=\"swift-modeXkeyword\">let</span> ctx <span class=\"swift-modeXoperator\">=</span> <span class=\"swift-modeXtype\">NSGraphicsContext</span><span class=\"swift-modeXoperator\">.</span><span class=\"swift-modeXbuiltin-property\">current</span><span class=\"swift-modeXoperator\">?.</span><span class=\"swift-modeXproperty-access\">cgContext</span> <span class=\"swift-modeXkeyword\">else</span> <span class=\"swift-modeXbracket\">{</span> <span class=\"swift-modeXkeyword\">return</span> <span class=\"swift-modeXstring\">\"\"</span> <span class=\"swift-modeXbracket\">}</span>\n\n    <span class=\"swift-modeXcomment-delimiter\">//</span><span class=\"swift-modeXcomment\"> Draw Border</span>\n    <span class=\"swift-modeXkeyword\">let</span> inset <span class=\"swift-modeXoperator\">=</span> borderWidth <span class=\"swift-modeXoperator\">/</span> <span class=\"swift-modeXnumber\">2</span>\n    <span class=\"swift-modeXkeyword\">let</span> rect <span class=\"swift-modeXoperator\">=</span> <span class=\"swift-modeXbuiltin-type\">NSRect</span><span class=\"swift-modeXbracket\">(</span>x<span class=\"swift-modeXdelimiter\">:</span> inset<span class=\"swift-modeXdelimiter\">,</span> y<span class=\"swift-modeXdelimiter\">:</span> inset<span class=\"swift-modeXdelimiter\">,</span> width<span class=\"swift-modeXdelimiter\">:</span> width <span class=\"swift-modeXoperator\">-</span> <span class=\"swift-modeXbracket\">(</span>inset <span class=\"swift-modeXoperator\">*</span> <span class=\"swift-modeXnumber\">2</span><span class=\"swift-modeXbracket\">)</span><span class=\"swift-modeXdelimiter\">,</span> height<span class=\"swift-modeXdelimiter\">:</span> height <span class=\"swift-modeXoperator\">-</span> <span class=\"swift-modeXbracket\">(</span>inset <span class=\"swift-modeXoperator\">*</span> <span class=\"swift-modeXnumber\">2</span><span class=\"swift-modeXbracket\">))</span>\n    <span class=\"swift-modeXkeyword\">let</span> path <span class=\"swift-modeXoperator\">=</span> <span class=\"swift-modeXtype\">NSBezierPath</span><span class=\"swift-modeXbracket\">(</span>roundedRect<span class=\"swift-modeXdelimiter\">:</span> rect<span class=\"swift-modeXdelimiter\">,</span> xRadius<span class=\"swift-modeXdelimiter\">:</span> cornerRadius<span class=\"swift-modeXdelimiter\">,</span> yRadius<span class=\"swift-modeXdelimiter\">:</span> cornerRadius<span class=\"swift-modeXbracket\">)</span>\n    path<span class=\"swift-modeXoperator\">.</span><span class=\"swift-modeXproperty-access\">lineWidth</span> <span class=\"swift-modeXoperator\">=</span> borderWidth\n    color<span class=\"swift-modeXoperator\">.</span><span class=\"swift-modeXfunction-call\">setStroke</span><span class=\"swift-modeXbracket\">()</span>\n    path<span class=\"swift-modeXoperator\">.</span><span class=\"swift-modeXfunction-call\">stroke</span><span class=\"swift-modeXbracket\">()</span>\n\n    <span class=\"swift-modeXcomment-delimiter\">//</span><span class=\"swift-modeXcomment\"> Draw Text</span>\n    <span class=\"swift-modeXkeyword\">let</span> font <span class=\"swift-modeXoperator\">=</span> <span class=\"swift-modeXtype\">NSFont</span><span class=\"swift-modeXoperator\">.</span><span class=\"swift-modeXfunction-call\">monospacedDigitSystemFont</span><span class=\"swift-modeXbracket\">(</span>ofSize<span class=\"swift-modeXdelimiter\">:</span> fontSize<span class=\"swift-modeXdelimiter\">,</span> weight<span class=\"swift-modeXdelimiter\">:</span> <span class=\"swift-modeXoperator\">.</span><span class=\"swift-modeXproperty-access\">light</span><span class=\"swift-modeXbracket\">)</span>\n    <span class=\"swift-modeXkeyword\">let</span> paragraphStyle <span class=\"swift-modeXoperator\">=</span> <span class=\"swift-modeXtype\">NSMutableParagraphStyle</span><span class=\"swift-modeXbracket\">()</span>\n    paragraphStyle<span class=\"swift-modeXoperator\">.</span><span class=\"swift-modeXbuiltin-property\">alignment</span> <span class=\"swift-modeXoperator\">=</span> <span class=\"swift-modeXoperator\">.</span><span class=\"swift-modeXbuiltin-property\">center</span>\n\n    <span class=\"swift-modeXkeyword\">let</span> attrs<span class=\"swift-modeXdelimiter\">:</span> <span class=\"swift-modeXbracket\">[</span><span class=\"swift-modeXbuiltin-type\">NSAttributedString</span><span class=\"swift-modeXoperator\">.</span><span class=\"swift-modeXbuiltin-type\">Key</span><span class=\"swift-modeXdelimiter\">:</span> <span class=\"swift-modeXtype\">Any</span><span class=\"swift-modeXbracket\">]</span> <span class=\"swift-modeXoperator\">=</span> <span class=\"swift-modeXbracket\">[</span>\n        <span class=\"swift-modeXoperator\">.</span><span class=\"swift-modeXbuiltin-property\">font</span><span class=\"swift-modeXdelimiter\">:</span> font<span class=\"swift-modeXdelimiter\">,</span>\n        <span class=\"swift-modeXoperator\">.</span><span class=\"swift-modeXbuiltin-property\">foregroundColor</span><span class=\"swift-modeXdelimiter\">:</span> color<span class=\"swift-modeXdelimiter\">,</span>\n        <span class=\"swift-modeXoperator\">.</span><span class=\"swift-modeXbuiltin-property\">paragraphStyle</span><span class=\"swift-modeXdelimiter\">:</span> paragraphStyle\n    <span class=\"swift-modeXbracket\">]</span>\n\n    <span class=\"swift-modeXkeyword\">let</span> str <span class=\"swift-modeXoperator\">=</span> text <span class=\"swift-modeXkeyword\">as</span> <span class=\"swift-modeXbuiltin-type\">NSString</span>\n    <span class=\"swift-modeXkeyword\">let</span> strSize <span class=\"swift-modeXoperator\">=</span> str<span class=\"swift-modeXoperator\">.</span><span class=\"swift-modeXbuiltin-method\">size</span><span class=\"swift-modeXbracket\">(</span>withAttributes<span class=\"swift-modeXdelimiter\">:</span> attrs<span class=\"swift-modeXbracket\">)</span>\n    <span class=\"swift-modeXkeyword\">let</span> yPos <span class=\"swift-modeXoperator\">=</span> <span class=\"swift-modeXbracket\">(</span>height <span class=\"swift-modeXoperator\">-</span> strSize<span class=\"swift-modeXoperator\">.</span><span class=\"swift-modeXproperty-access\">height</span><span class=\"swift-modeXbracket\">)</span> <span class=\"swift-modeXoperator\">/</span> <span class=\"swift-modeXnumber\">2</span>\n    <span class=\"swift-modeXkeyword\">let</span> strRect <span class=\"swift-modeXoperator\">=</span> <span class=\"swift-modeXbuiltin-type\">NSRect</span><span class=\"swift-modeXbracket\">(</span>x<span class=\"swift-modeXdelimiter\">:</span> <span class=\"swift-modeXnumber\">0</span><span class=\"swift-modeXdelimiter\">,</span> y<span class=\"swift-modeXdelimiter\">:</span> yPos<span class=\"swift-modeXdelimiter\">,</span> width<span class=\"swift-modeXdelimiter\">:</span> width<span class=\"swift-modeXdelimiter\">,</span> height<span class=\"swift-modeXdelimiter\">:</span> strSize<span class=\"swift-modeXoperator\">.</span><span class=\"swift-modeXproperty-access\">height</span><span class=\"swift-modeXbracket\">)</span>\n\n    str<span class=\"swift-modeXoperator\">.</span><span class=\"swift-modeXbuiltin-method\">draw</span><span class=\"swift-modeXbracket\">(</span><span class=\"swift-modeXkeyword\">in</span><span class=\"swift-modeXdelimiter\">:</span> strRect<span class=\"swift-modeXdelimiter\">,</span> withAttributes<span class=\"swift-modeXdelimiter\">:</span> attrs<span class=\"swift-modeXbracket\">)</span>\n\n    img<span class=\"swift-modeXoperator\">.</span><span class=\"swift-modeXfunction-call\">unlockFocus</span><span class=\"swift-modeXbracket\">()</span>\n\n    <span class=\"swift-modeXkeyword\">guard</span> <span class=\"swift-modeXkeyword\">let</span> tiff <span class=\"swift-modeXoperator\">=</span> img<span class=\"swift-modeXoperator\">.</span><span class=\"swift-modeXproperty-access\">tiffRepresentation</span><span class=\"swift-modeXdelimiter\">,</span>\n          <span class=\"swift-modeXkeyword\">let</span> bitmap <span class=\"swift-modeXoperator\">=</span> <span class=\"swift-modeXtype\">NSBitmapImageRep</span><span class=\"swift-modeXbracket\">(</span>data<span class=\"swift-modeXdelimiter\">:</span> tiff<span class=\"swift-modeXbracket\">)</span><span class=\"swift-modeXdelimiter\">,</span>\n          <span class=\"swift-modeXkeyword\">let</span> png <span class=\"swift-modeXoperator\">=</span> bitmap<span class=\"swift-modeXoperator\">.</span><span class=\"swift-modeXfunction-call\">representation</span><span class=\"swift-modeXbracket\">(</span>using<span class=\"swift-modeXdelimiter\">:</span> <span class=\"swift-modeXoperator\">.</span><span class=\"swift-modeXproperty-access\">png</span><span class=\"swift-modeXdelimiter\">,</span> properties<span class=\"swift-modeXdelimiter\">:</span> <span class=\"swift-modeXbracket\">[</span><span class=\"swift-modeXoperator\">:</span><span class=\"swift-modeXbracket\">])</span> <span class=\"swift-modeXkeyword\">else</span> <span class=\"swift-modeXbracket\">{</span> <span class=\"swift-modeXkeyword\">return</span> <span class=\"swift-modeXstring\">\"\"</span> <span class=\"swift-modeXbracket\">}</span>\n\n    <span class=\"swift-modeXkeyword\">return</span> png<span class=\"swift-modeXoperator\">.</span><span class=\"swift-modeXbuiltin-method\">base64EncodedString</span><span class=\"swift-modeXbracket\">()</span>\n<span class=\"swift-modeXbracket\">}</span>\n\n<span class=\"swift-modeXcomment-delimiter\">//</span><span class=\"swift-modeXcomment\"> --- Main ---</span>\n<span class=\"swift-modeXkeyword\">let</span> state <span class=\"swift-modeXoperator\">=</span> <span class=\"swift-modeXfunction-call\">getCurrentState</span><span class=\"swift-modeXbracket\">()</span>\n<span class=\"swift-modeXkeyword\">let</span> scriptPath <span class=\"swift-modeXoperator\">=</span> <span class=\"swift-modeXbuiltin-type\">CommandLine</span><span class=\"swift-modeXoperator\">.</span><span class=\"swift-modeXbuiltin-property\">arguments</span><span class=\"swift-modeXbracket\">[</span><span class=\"swift-modeXnumber\">0</span><span class=\"swift-modeXbracket\">]</span>\n\n<span class=\"swift-modeXkeyword\">switch</span> <span class=\"swift-modeXfunction-call\">state</span> <span class=\"swift-modeXbracket\">{</span>\n<span class=\"swift-modeXkeyword\">case</span> <span class=\"swift-modeXoperator\">.</span><span class=\"swift-modeXfunction-call\">work</span><span class=\"swift-modeXbracket\">(</span><span class=\"swift-modeXkeyword\">let</span> timeStr<span class=\"swift-modeXbracket\">)</span><span class=\"swift-modeXdelimiter\">:</span>\n    <span class=\"swift-modeXkeyword\">let</span> img <span class=\"swift-modeXoperator\">=</span> <span class=\"swift-modeXfunction-call\">createBase64Image</span><span class=\"swift-modeXbracket\">(</span>text<span class=\"swift-modeXdelimiter\">:</span> timeStr<span class=\"swift-modeXdelimiter\">,</span> color<span class=\"swift-modeXdelimiter\">:</span> colorWork<span class=\"swift-modeXbracket\">)</span>\n    <span class=\"swift-modeXbuiltin-function\">print</span><span class=\"swift-modeXbracket\">(</span><span class=\"swift-modeXstring\">\" | image=</span><span class=\"swift-modeXstring\"><span class=\"swift-modeXmisc-punctuation\">\\(</span></span>img<span class=\"swift-modeXstring\"><span class=\"swift-modeXmisc-punctuation\">)</span></span><span class=\"swift-modeXstring\"> bash='</span><span class=\"swift-modeXstring\"><span class=\"swift-modeXmisc-punctuation\">\\(</span></span>scriptPath<span class=\"swift-modeXstring\"><span class=\"swift-modeXmisc-punctuation\">)</span></span><span class=\"swift-modeXstring\">' param1=stop_work terminal=false refresh=true\"</span><span class=\"swift-modeXbracket\">)</span>\n    <span class=\"swift-modeXbuiltin-function\">print</span><span class=\"swift-modeXbracket\">(</span><span class=\"swift-modeXstring\">\"---\"</span><span class=\"swift-modeXbracket\">)</span>\n    <span class=\"swift-modeXbuiltin-function\">print</span><span class=\"swift-modeXbracket\">(</span><span class=\"swift-modeXstring\">\"Clock Out | bash='</span><span class=\"swift-modeXstring\"><span class=\"swift-modeXmisc-punctuation\">\\(</span></span>scriptPath<span class=\"swift-modeXstring\"><span class=\"swift-modeXmisc-punctuation\">)</span></span><span class=\"swift-modeXstring\">' param1=stop_work terminal=false refresh=true\"</span><span class=\"swift-modeXbracket\">)</span>\n\n<span class=\"swift-modeXkeyword\">case</span> <span class=\"swift-modeXoperator\">.</span><span class=\"swift-modeXfunction-call\">breakTime</span><span class=\"swift-modeXbracket\">(</span><span class=\"swift-modeXkeyword\">let</span> timeStr<span class=\"swift-modeXbracket\">)</span><span class=\"swift-modeXdelimiter\">:</span>\n    <span class=\"swift-modeXkeyword\">let</span> img <span class=\"swift-modeXoperator\">=</span> <span class=\"swift-modeXfunction-call\">createBase64Image</span><span class=\"swift-modeXbracket\">(</span>text<span class=\"swift-modeXdelimiter\">:</span> timeStr<span class=\"swift-modeXdelimiter\">,</span> color<span class=\"swift-modeXdelimiter\">:</span> colorBreak<span class=\"swift-modeXbracket\">)</span>\n    <span class=\"swift-modeXbuiltin-function\">print</span><span class=\"swift-modeXbracket\">(</span><span class=\"swift-modeXstring\">\" | image=</span><span class=\"swift-modeXstring\"><span class=\"swift-modeXmisc-punctuation\">\\(</span></span>img<span class=\"swift-modeXstring\"><span class=\"swift-modeXmisc-punctuation\">)</span></span><span class=\"swift-modeXstring\"> bash='</span><span class=\"swift-modeXstring\"><span class=\"swift-modeXmisc-punctuation\">\\(</span></span>scriptPath<span class=\"swift-modeXstring\"><span class=\"swift-modeXmisc-punctuation\">)</span></span><span class=\"swift-modeXstring\">' param1=stop_break terminal=false refresh=true\"</span><span class=\"swift-modeXbracket\">)</span>\n    <span class=\"swift-modeXbuiltin-function\">print</span><span class=\"swift-modeXbracket\">(</span><span class=\"swift-modeXstring\">\"---\"</span><span class=\"swift-modeXbracket\">)</span>\n    <span class=\"swift-modeXbuiltin-function\">print</span><span class=\"swift-modeXbracket\">(</span><span class=\"swift-modeXstring\">\"Stop Break | bash='</span><span class=\"swift-modeXstring\"><span class=\"swift-modeXmisc-punctuation\">\\(</span></span>scriptPath<span class=\"swift-modeXstring\"><span class=\"swift-modeXmisc-punctuation\">)</span></span><span class=\"swift-modeXstring\">' param1=stop_break terminal=false refresh=true\"</span><span class=\"swift-modeXbracket\">)</span>\n\n<span class=\"swift-modeXkeyword\">case</span> <span class=\"swift-modeXoperator\">.</span><span class=\"swift-modeXproperty-access\">idle</span><span class=\"swift-modeXdelimiter\">:</span>\n    <span class=\"swift-modeXkeyword\">let</span> img <span class=\"swift-modeXoperator\">=</span> <span class=\"swift-modeXfunction-call\">createBase64Image</span><span class=\"swift-modeXbracket\">(</span>text<span class=\"swift-modeXdelimiter\">:</span> <span class=\"swift-modeXbuiltin-type\">String</span><span class=\"swift-modeXbracket\">(</span>format<span class=\"swift-modeXdelimiter\">:</span> <span class=\"swift-modeXstring\">\"%.0f:00\"</span><span class=\"swift-modeXdelimiter\">,</span> workDuration<span class=\"swift-modeXbracket\">)</span><span class=\"swift-modeXdelimiter\">,</span> color<span class=\"swift-modeXdelimiter\">:</span> colorWork<span class=\"swift-modeXbracket\">)</span>\n    <span class=\"swift-modeXbuiltin-function\">print</span><span class=\"swift-modeXbracket\">(</span><span class=\"swift-modeXstring\">\" | image=</span><span class=\"swift-modeXstring\"><span class=\"swift-modeXmisc-punctuation\">\\(</span></span>img<span class=\"swift-modeXstring\"><span class=\"swift-modeXmisc-punctuation\">)</span></span><span class=\"swift-modeXstring\">\"</span><span class=\"swift-modeXbracket\">)</span>\n    <span class=\"swift-modeXbuiltin-function\">print</span><span class=\"swift-modeXbracket\">(</span><span class=\"swift-modeXstring\">\"---\"</span><span class=\"swift-modeXbracket\">)</span>\n    <span class=\"swift-modeXbuiltin-function\">print</span><span class=\"swift-modeXbracket\">(</span><span class=\"swift-modeXstring\">\"Start from Emacs (org-clock-in)\"</span><span class=\"swift-modeXbracket\">)</span>\n<span class=\"swift-modeXbracket\">}</span>\n</code></pre>\n\n<p>This works if you place it in the SwiftBar plugin directory as a file like <code>pomodoro.1s.swift</code>.</p>\n<p>By the way, I haven't thoroughly investigated how SwiftBar works, but leaving it as is might mean that the Swift compiler runs once every second. So, it's probably better to compile it and place the binary there instead, like this:</p>\n<pre><code class=\"shell\">swiftc -O pomodoro.1s.swift -o pomodoro.1s.bin</code></pre>\n<h3>Integrating with Emacs</h3>\n<p>The SwiftBar plugin above monitors <code>/tmp/my_pomodoro_timer</code> and operates the timer based on that file. So, all we need to do is create that file from Emacs.</p>\n<p>I configured it as follows:</p>\n<pre><code class=\"emacs-lisp\"><span class=\"comment-delimiter\">;; </span><span class=\"comment\">pomodoro</span>\n(<span class=\"keyword\">with-eval-after-load</span> 'org\n  (<span class=\"keyword\">defvar</span> <span class=\"variable-name\">my</span>/pomodoro-timer-file <span class=\"string\">\"/tmp/my_pomodoro_timer\"</span>)\n  (<span class=\"keyword\">defvar</span> <span class=\"variable-name\">my</span>/pomodoro-duration 25)\n\n  (<span class=\"keyword\">defun</span> <span class=\"function-name\">my/pomodoro-start-timer</span> ()\n    (<span class=\"keyword\">let*</span> ((end-time (time-add (current-time) (seconds-to-time (* my/pomodoro-duration 60))))\n           (end-time-float (float-time end-time)))\n      (<span class=\"keyword\">with-temp-file</span> my/pomodoro-timer-file\n        (insert (format <span class=\"string\">\"%.0f\"</span> end-time-float)))))\n\n  (<span class=\"keyword\">defun</span> <span class=\"function-name\">my/pomodoro-stop-timer</span> ()\n    (<span class=\"keyword\">when</span> (file-exists-p my/pomodoro-timer-file)\n      (delete-file my/pomodoro-timer-file)))\n\n  (add-hook 'org-clock-in-hook 'my/pomodoro-start-timer)\n  (add-hook 'org-clock-out-hook 'my/pomodoro-stop-timer))</code></pre>\n\n<p>With this, I've completed a system where the timer starts automatically when I clock in.</p>\n<p>Also, stopping the timer (clock-out) can be done from the menu bar app, and when time runs out, it rings a bell and simultaneously clocks out in Emacs. It's very convenient.</p>\n<p>The design isn't exactly the same as Flow, but it's quite close, and I'm satisfied.</p>\n<aside class=\"footdef\">\n<p id=\"fn1\"><a href=\"#r1\">[1]</a> Source code for this site is here: <a href=\"https://github.com/typester/typester.dev\">https://github.com/typester/typester.dev</a></p>\n</aside>\n"}
