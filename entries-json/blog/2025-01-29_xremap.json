{"title":"Migrating keyboard remapper to Xremap","date":"2025-01-29T09:07:00-08:00","tags":["linux","wayland","xremap","river"],"eid":"e8e36786-de37-4160-995d-f199c0a774f8","image":null,"content":"<p>I had been looking for a remapper that allows changing key mappings <strong>per application</strong> on Wayland, but I struggled to find a good one.</p>\n<p>Recently, I happened to come across <a href=\"https://github.com/xremap/xremap\">Xremap</a> again and decided to reread its README. I had known about this tool for a long time, but I remember it being written in Python back then and lacking Wayland support. However, it is now written in Rust and supports Wayland. It also seemed to support everything I wanted to achieve.</p>\n<p>So, I decided to give it a try.</p>\n\n<h3>Installation</h3>\n<p>I use Arch Linux with <a href=\"https://isaacfreund.com/software/river/\">river</a>.</p>\n<p>Since river is a wlroots-based window manager, I installed the following:</p>\n<pre><code class=\"sh\">&#10095; paru -S xremap-wlroots-bin</code></pre>\n\n<h3>Configuration</h3>\n<p>Add the user to the input group and set up a udev rule.</p>\n<pre><code class=\"sh\">&#10095; sudo usermod -a -G input $<span class=\"variable-name\">USER</span>\n&#10095; echo <span class=\"string\">'KERNEL==\"uinput\", GROUP=\"input\", TAG+=\"uaccess\"'</span> | sudo tee /etc/udev/rules.d/99-input.rules</code></pre>\n\n<p>Then, restart the system.</p>\n\n<h3>Remapping Configuration</h3>\n<p>Hereâ€™s what I wanted to achieve with this tool:</p>\n<ul>\n<li>Use the Space key as Shift when held but as Space when pressed alone.\n<ul>\n<li>Disable this functionality for specific applications (mainly games).</li>\n</ul></li>\n<li>Adjust key mappings for each keyboard hardware.</li>\n</ul>\n\n<p>The following configuration meets these requirements:</p>\n<pre><code class=\"yaml\"><span class=\"variable-name\">shared</span>:\n  <span class=\"variable-name\">games</span>: <span class=\"function-name\">&amp;games</span>\n    - steam_app_default  <span class=\"comment-delimiter\"># </span><span class=\"comment\">DiabloIV</span>\n    - steam_app_2694490  <span class=\"comment-delimiter\"># </span><span class=\"comment\">POE2</span>\n\n<span class=\"variable-name\">modmap</span>:\n  - <span class=\"variable-name\">name</span>: SandS\n    <span class=\"variable-name\">application</span>:\n      <span class=\"variable-name\">not</span>: <span class=\"function-name\">*games</span>\n    <span class=\"variable-name\">remap</span>:\n      <span class=\"variable-name\">Space</span>:\n        <span class=\"variable-name\">held</span>: Shift_L\n        <span class=\"variable-name\">alone</span>: Space\n        <span class=\"variable-name\">alone_timeout_millis</span>: 999999999\n\n  - <span class=\"variable-name\">name</span>: HHKB\n    <span class=\"variable-name\">device</span>:\n      <span class=\"variable-name\">only</span>: <span class=\"string\">\"Topre Corporation HHKB Professional\"</span>\n    <span class=\"variable-name\">remap</span>:\n      <span class=\"variable-name\">KEY_GRAVE</span>: KEY_ESC\n      <span class=\"variable-name\">KEY_ESC</span>: KEY_GRAVE\n      <span class=\"variable-name\">KEY_BACKSLASH</span>: KEY_BACKSPACE\n      <span class=\"variable-name\">KEY_BACKSPACE</span>: KEY_BACKSLASH</code></pre>\n\n<p>The startup command is set in the river configuration:</p>\n<pre><code class=\"sh\">xremap ~/.config/xremap/config.yaml --watch=config,device &amp;</code></pre>\n\n<p>This is how I start it.</p>\n\n<h4>Unclear Aspects</h4>\n<ol>\n<li>The <code>alone_timeout_millis</code> setting</li>\n<li>How to specify applications</li>\n<li>The <code>watch</code> command-line option</li>\n</ol>\n\n<h5>The <code>alone_timeout_millis</code> Setting</h5>\n<p>I wanted to disable this timeout, so I initially set it to <code>0</code>. However, this caused the Space key to no longer function as Space when pressed aloneðŸ˜‚\nI canâ€™t imagine anyone wanting that behavior, so it didnâ€™t make sense at all. For now, I decided to set it to a sufficiently large value.</p>\n\n<h5>How to Specify Applications</h5>\n<p>The documentation includes an example for Sway, but there was no description of how to specify applications in general wlroots-based WMs. I wasnâ€™t sure what to use at the first glance.\nAfter some experimentation, I found that specifying the <code>app_id</code> retrieved from <code>lswt</code> seems to work.</p>\n\n<h5>The <code>watch</code> Command-Line Option</h5>\n<p>Initially, I simply specified <code>--watch</code>, but it didnâ€™t seem to enable automatic config reloading.  \nIt appears that specifying it more explicitly, such as <code>--watch=config</code>, is necessary for it to work.</p>\n\n<h3>Summary</h3>\n<p>Despite some unclear aspects, Iâ€™m satisfied with the setup for now. Xremap also has other interesting features, so Iâ€™d like to explore them at some point.</p>\n"}
